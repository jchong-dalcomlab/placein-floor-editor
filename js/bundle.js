var PlaceIn;(()=>{"use strict";var t={d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Editor:()=>lt,EditorTools:()=>ct});class s{constructor(){}get type(){return""}translate(t,e){}render(t){this.renderControl(t)}onMove(t,e){}renderControl(t){}createPointDragHandler(t,e,s){return null}createMoveDragHandler(t,e,s){return null}createExtendDragHandler(t,e,s){return null}createSelectionControl(){return null}isPointInControl(t,e){return!1}}class o{static radiansToDegrees(t){return t*(180/Math.PI)}static degreesToRadians(t){return t*(Math.PI/180)}static angle(t,e,s,o){const n=this.radian(t,e,s,o);return this.radiansToDegrees(n)}static radian(t,e,s,o){return Math.atan2(o-e,s-t)}static radianInPoint(t,e){return this.radian(t.x,t.y,e.x,e.y)}static calculate3PointRadian(t,e,s,o,n,i){const r=this.radian(t,e,s,o);let h=this.radian(t,e,n,i)-r;return h<0&&(h+=2*Math.PI),h}static calculate3PointRadianInPoint(t,e,s){return this.calculate3PointRadian(t.x,t.y,e.x,e.y,s.x,s.y)}static calculate3PointDegrees(t,e,s,o,n,i){return this.radiansToDegrees(this.calculate3PointRadian(t,e,s,o,n,i))}static calculate3PointAngle(...t){let e,s,o,n,i,r;if(6===t.length)[e,s,o,n,i,r]=t;else{if(3!==t.length)throw new Error("올바른 인자를 제공하세요.");{const[h,a,l]=t;e=h.x,s=h.y,o=a.x,n=a.y,i=l.x,r=l.y}}const h=Math.atan2(n-s,o-e);let a=Math.atan2(r-s,i-e)-h;return a<0&&(a+=2*Math.PI),this.radiansToDegrees(a)}static distance(t,e,s,o){const n=s-t,i=o-e;return Math.sqrt(n**2+i**2)}static distanceInPoint(t,e){const s=e.x-t.x,o=e.y-t.y;return Math.sqrt(s**2+o**2)}static isBetween(t,e,s,o=!1){return o&&(t=Math.round(t),e=Math.round(e),s=Math.round(s)),t>=e&&t<=s||t>=s&&t<=e}static distancePoint(t,e,s){const o=Math.atan2(e.y-t.y,e.x-t.x),i=new n(0,0);return i.x=t.x-s*Math.cos(o),i.y=t.y-s*Math.sin(o),i}static rotate(t,e,s,o,n){const i=t-s,r=e-o;return[i*Math.cos(n)-r*Math.sin(n)+s,i*Math.sin(n)+r*Math.cos(n)+o]}static rotatePoint(t,e,s,o){const i=t.x-e,r=t.y-s,h=i*Math.cos(o)-r*Math.sin(o),a=i*Math.sin(o)+r*Math.cos(o);return new n(h+e,a+s)}static interceptPoint(t,e,s,o,i,r,h,a){const l=(t-s)*(r-a)-(e-o)*(i-h);if(0===l)return null;const c=((t-i)*(r-a)-(e-r)*(i-h))/l;if(c>0&&c<1&&-((t-s)*(e-r)-(e-o)*(t-i))/l>0){const l=new n(0,0);return l.x=Math.round(t+c*(s-t)),l.y=Math.round(e+c*(o-e)),this.isPointInBox(l.x,l.y,t,e,s,o)&&this.isPointInBox(l.x,l.y,i,r,h,a)?l:null}return null}static isPointInBox(t,e,s,o,n,i){let r=Math.min(s,n),h=Math.max(s,n),a=Math.min(o,i),l=Math.max(o,i);return r===h&&(r-=1,h+=1),a===l&&(a-=1,l+=1),t>=r&&t<=h&&e>=a&&e<=l}}class n{constructor(t,e){this.x=t,this.y=e}copy(){return new n(this.x,this.y)}copyFrom(t){t&&(this.x=t.x,this.y=t.y)}distance(t,e){return o.distance(this.x,this.y,t,e)}static rotate(t,e,s,i){const r=[];for(const h of t){const t=o.rotate(h.x,h.y,e,s,i);r.push(new n(t[0],t[1]))}return r}}class i{constructor(){this.points=[]}get count(){return this.points.length}add(t,e){this.points.push(new n(t,e))}first(){return this.count>1?this.points[0]:null}last(){return this.count>1?this.points[this.count-1]:null}rotate(t,e,s){for(const n of this.points){const i=o.rotate(n.x,n.y,t,e,s);n.x=i[0],n.y=i[1]}}contains(t,e){let s=!1;for(let o=0,n=this.points.length-1;o<this.points.length;n=o++){if(this.points[o].x===t&&this.points[o].y===e)return!0;const i=this.points[o].x,r=this.points[o].y,h=this.points[n].x,a=this.points[n].y;r>e!=a>e&&t<(h-i)*(e-r)/(a-r)+i&&(s=!s)}return s}containsInPoint(t){return this.contains(t.x,t.y)}static createOuterPolygon(t,e,s,n=0){const r=new i,h=o.distancePoint(t,e,n),a=o.distancePoint(e,t,n),l=o.distance(h.x,h.y,a.x,a.y),c=o.radian(h.x,h.y,a.x,a.y),d=s/2;return r.add(h.x,h.y-d),r.add(h.x,h.y+d),r.add(h.x+l,h.y+d),r.add(h.x+l,h.y-d),r.rotate(h.x,h.y,c),r}static isPointInPolygon(t,e,s){const o=new i;return o.points=t,o.contains(e,s)}}class r{constructor(){this.x=0,this.y=0,this.start,this.end}static createVector(t,e,s,o){const i=new r;return i.x=s-t,i.y=o-e,i.start=new n(t,e),i.end=new n(s,o),i}getLength(){return Math.sqrt(this.x**2+this.y**2)}static createVectorOfPoints(t,e){return this.createVector(t.x,t.y,e.x,e.y)}dotProduct(t){return this.x*t.x+this.y*t.y}}class h{constructor(){this.start=new n(0,0),this.end=new n(0,0)}static create(t,e,s,o){const n=new h;return n.x1=t,n.y1=e,n.x2=s,n.y2=o,n}get slope(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}get x1(){return this.start.x}set x1(t){this.start.x=t}get y1(){return this.start.y}set y1(t){this.start.y=t}get x2(){return this.end.x}set x2(t){this.end.x=t}get y2(){return this.end.y}set y2(t){this.end.y=t}get width(){return Math.abs(this.end.x-this.start.x)}get height(){return Math.abs(this.end.y-this.start.y)}get length(){return Math.sqrt(Math.pow(this.end.x-this.start.x,2)+Math.pow(this.end.y-this.start.y,2))}get radian(){return o.radian(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return o.radiansToDegrees(this.radian)}intercept(t,e){const s=this.slope;return s*t+(this.start.y-s*this.start.x)===e}rect(){const t=new a;return t.x=Math.min(this.start.x,this.end.x),t.y=Math.min(this.start.y,this.end.y),t.width=this.width,t.height=this.height,t}}class a{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}static create(t,e,s,o){const n=new a;return n.x=t,n.y=e,n.width=s,n.height=o,n}points(){return[new n(this.x,this.y),new n(this.x+this.width,this.y),new n(this.x+this.width,this.y+this.height),new n(this.x,this.y+this.height)]}getTopLeftPoint(){const t=Math.min(this.x,this.x+this.width),e=Math.min(this.y,this.y+this.height);return new n(t,e)}getTopRightPoint(){const t=Math.max(this.x,this.x+this.width),e=Math.min(this.y,this.y+this.height);return new n(t,e)}getBottomLeftPoint(){const t=Math.min(this.x,this.x+this.width),e=Math.max(this.y,this.y+this.height);return new n(t,e)}getBottomRightPoint(){const t=Math.max(this.x,this.x+this.width),e=Math.max(this.y,this.y+this.height);return new n(t,e)}segments(){const t=[];return t.push({x1:this.x,y1:this.y,x2:this.x+this.width,y2:this.y}),t.push({x1:this.x+this.width,y1:this.y,x2:this.x+this.width,y2:this.y+this.height}),t.push({x1:this.x+this.width,y1:this.y+this.height,x2:this.x,y2:this.y+this.height}),t.push({x1:this.x,y1:this.y+this.height,x2:this.x,y2:this.y}),t}isPointInRect(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}translate(t,e){this.x+=t,this.y+=e}}class l{onDragStart(t,e,s){}onDrag(t,e){}onDragStop(t,e){}}class c extends l{constructor(t,e,s){super(),this.floor=t,this.wall=e,this.handlers=[],this.equation=this.wall.createEquation();const{start:o,end:n}=this.wall;this.startPointEquation=this.equation.createPerpendicularEquation(o.x,o.y),this.endPointEquation=this.equation.createPerpendicularEquation(n.x,n.y),this.childs=s}addHandler(t){for(const e of t)this.handlers.push(e);console.log(this.handlers)}onDrag(t,e){this.equation=this.equation.createMoveEquation(t,e);const s=this.equation.intersection(this.startPointEquation),o=this.equation.intersection(this.endPointEquation);this.wall.start.copyFrom(s),this.wall.end.copyFrom(o);for(const t of this.handlers)t.onMove(this.floor,this.wall,this.equation);if(this.childs)for(const t of this.childs)t.start.copyFrom(this.equation.closestPoint(t.start.x,t.start.y)),t.end.copyFrom(this.equation.closestPoint(t.end.x,t.end.y))}}class d{constructor(t,e,s){this.follow=t,this.point=e,this.which=s}onMove(t,e,s){"start"===this.which?this.point.copyFrom(e.start):this.point.copyFrom(e.end)}}class u{constructor(t,e){this.follower=t,this.which=e,this.start=this.follower.start.copy(),this.end=this.follower.end.copy(),this.polygon=this.follower.createOuterPolygon()}onMove(t,e,s){const i=new n(0,0);"start"===this.which?i.copyFrom(e.start):i.copyFrom(e.end);const{start:r,end:h}=this.follower;this.isPointOnWall(i.x,i.y)?this.restorePoints():o.distanceInPoint(r,i)>o.distanceInPoint(h,i)?this.changeEndPoint(i):this.changeStartPoint(i)}changeStartPoint(t){this.follower.start.copyFrom(t)}changeEndPoint(t){this.follower.end.copyFrom(t)}restorePoints(){this.changeStartPoint(this.start),this.changeEndPoint(this.end)}isPointOnWall(t,e){return this.polygon.contains(t,e)}}class y{constructor(){this.followers=[]}addFollow(t,e){t&&this.followers.push({wall:t,point:e,equation:t.createEquation()})}onMove(t,e,s){const o=this.moveFollowers(e,s);this.removeFollowers(t,o)}moveFollowers(t,e){const s=[];for(const n of this.followers){const i=e.intersection(n.equation);o.isBetween(i.x,t.start.x,t.end.x)&&o.isBetween(i.y,t.start.y,t.end.y)&&(n.point.x=i.x,n.point.y=i.y,o.distanceInPoint(n.wall.start,n.wall.end)<5&&s.push(n))}return s}removeFollowers(t,e){for(const s of e)t.removeControl(s.wall),this.followers.splice(this.followers.indexOf(s),1)}}class x{static Colors={Blue10:"#E5F2FF",Blue20:"#CCE4FF",Blue30:"#99CAFF",Blue40:"#66AFFF",Blue50:"#3395FF",Blue60:"#007AFF",Blue70:"#0062CC",Blue80:"#004999",Blue90:"#003166",Blue100:"#001833",BlueHover10:"#DAE6F2",BlueHover20:"#C2D9F2",BlueHover30:"#91C0F2",BlueHover40:"#61A6F2",BlueHover50:"#308EF2",BlueHover60:"#0D81FF",BlueHover70:"#0D6ACF",BlueHover80:"#0D529E",BlueHover90:"#0D3B6E",BlueHover100:"#0D243D",Purple10:"#F7EEFC",Purple20:"#EFDCF8",Purple30:"#DFBAF2",Purple40:"#CF97EB",Purple50:"#BF75E5",Purple60:"#AF52DE",Purple70:"#8C42B2",Purple80:"#693185",Purple90:"#462159",Purple100:"#23102C",PurpleHorver10:"#EBE2EF",PurpleHorver20:"#E3D1EC",PurpleHorver30:"#D4B1E6",PurpleHorver40:"#C58FDF",PurpleHorver50:"#B56FDA",PurpleHorver60:"#B35BE0",PurpleHorver70:"#924BB6",PurpleHorver80:"#713B8B",PurpleHorver90:"#4F2C61",PurpleHorver100:"#2E1C37",Cyan10:"#EAF7FC",Cyan20:"#D6EFFA",Cyan30:"#ADDEF5",Cyan40:"#84CEF0",Cyan50:"#5BBDEB",Cyan60:"#32ADE6",Cyan70:"#288AB8",Cyan80:"#1E688A",Cyan90:"#14455C",Cyan100:"#0A232E",CyanHover10:"#DEEBEF",CyanHover20:"#CBE3ED",CyanHover30:"#A4D3E9",CyanHover40:"#7DC4E4",CyanHover50:"#56B4DF",CyanHover60:"#3CB1E7",CyanHover70:"#3390BC",CyanHover80:"#297090",CyanHover90:"#204E64",CyanHover100:"#162E38",Teal10:"#EAF7F9",Teal20:"#D6EFF4",Teal30:"#ACDFE9",Teal40:"#83D0DD",Teal50:"#59C0D2",Teal60:"#30B0C7",Teal70:"#268D9F",Teal80:"#1D6A77",Teal90:"#134650",Teal100:"#0A2328",TealHover10:"#DEEBED",TealHover20:"#CBE3E8",TealHover30:"#A3D4DD",TealHover40:"#7CC6D2",TealHover50:"#55B6C7",TealHover60:"#3AB4CA",TealHover70:"#3193A4",TealHover80:"#28717E",TealHover90:"#1F4F59",TealHover100:"#162E33",Manneta10:"#FAE9F1",Manneta20:"#F6D4E3",Manneta30:"#EDA9C6",Manneta40:"#E37DAA",Manneta50:"#DA528D",Manneta60:"#D12771",Manneta70:"#A71F5A",Manneta80:"#7D1744",Manneta90:"#54102D",Manneta100:"#2A0817",MannetaHover10:"#EDDDE5",MannetaHover20:"#EAC9D8",MannetaHover30:"#E1A1BC",MannetaHover40:"#D877A1",MannetaHover50:"#CF4E86",MannetaHover60:"#D33278",MannetaHover70:"#AB2A62",MannetaHover80:"#83234D",MannetaHover90:"#5D1C38",MannetaHover100:"#351423",Red10:"#FFEBEA",Red20:"#FFD8D6",Red30:"#FFB1AC",Red40:"#FF8983",Red50:"#FF6259",Red60:"#FF3B30",Red70:"#CC2F26",Red80:"#99231D",Red90:"#661813",Red100:"#330C0A",RedHover10:"#F2DFDE",RedHover20:"#F2CDCB",RedHover30:"#F2A8A3",RedHover40:"#F2827C",RedHover50:"#F25D55",RedHover60:"#FF453A",RedHover70:"#CF3931",RedHover80:"#9E2E28",RedHover90:"#6E241F",RedHover100:"#3D1816",Green10:"#EBF9EE",Green20:"#D6F4DE",Green30:"#AEE9BD",Green40:"#85DD9B",Green50:"#5DD27A",Green60:"#34C759",Green70:"#2A9F47",Green80:"#1F7735",Green90:"#155024",Green100:"#0A2812",GreenHover10:"#DFEDE2",GreenHover20:"#CBE8D3",GreenHover30:"#A5DDB4",GreenHover40:"#7ED293",GreenHover50:"#58C774",GreenHover60:"#3ECA61",GreenHover70:"#35A450",GreenHover80:"#2A7E3F",GreenHover90:"#21592F",GreenHover100:"#16331E",Orange10:"#FFF4E5",Orange20:"#FFEACC",Orange30:"#FFD599",Orange40:"#FFBF66",Orange50:"#FFAA33",Orange60:"#FF9500",Orange70:"#CC7700",Orange80:"#995900",Orange90:"#663C00",Orange100:"#331E00",OrangeHover10:"#F2E8DA",OrangeHover20:"#F2DEC2",OrangeHover30:"#F2CA91",OrangeHover40:"#F2B561",OrangeHover50:"#F2A130",OrangeHover60:"#FF9A0D",OrangeHover70:"#CF7E0D",OrangeHover80:"#9E610D",OrangeHover90:"#6E460D",OrangeHover100:"#3D290D"};static get activeColor(){return"#0097c5"}static get selectColor(){return"rgba(0,151,197,0.5)"}}class w extends s{constructor(t,e){super(),this.start=t,this.end=e,this.height=15,this.padding=10,this.points=[],this.thick=1,this.strokeColor=x.activeColor,this.fillColor=x.activeColor}addPoint(t){t&&this.points.push(t)}render(t){const e=o.radianInPoint(this.start,this.end);t.save(),t.translate(this.start.x,this.start.y),t.rotate(e),this.renderRuler(t,this.start.x,this.start.y,-e,!0),this.renderRuler(t,this.start.x,this.start.y,-e,!1),t.restore()}renderRuler(t,e,s,o,n){t.lineWidth=this.thick,t.strokeStyle=this.strokeColor,t.fillStyle=this.fillColor,t.font="10px Arial";for(const i of this.createSegment(e,s,o,n)){const{start:e,end:s}=i;t.line(e.x,e.y,e.x,e.y+this.height),t.line(e.x,e.y,e.x,e.y-this.height),t.line(s.x,s.y,s.x,s.y+this.height),t.line(s.x,s.y,s.x,s.y-this.height),t.line(e.x,e.y,s.x,s.y),t.arrow(e.x,e.y,5,"left"),t.arrow(s.x,s.y,5,"right"),t.text((e.x+s.x)/2,e.y-10,`${Math.round(i.length)} px`)}}createSegment(t,e,s,o){const n=this.createRotatedPoints(t,e,s);o?e+=this.padding+this.height:e-=this.padding+this.height;const i=[];for(let s=0;s<n.length-1;s++){const o=new h;o.start={x:n[s].x-t,y:n[s].y-e},o.end={x:n[s+1].x-t,y:n[s+1].y-e},i.push(o)}return i}createSegments(){const t=this.createPoints(),e=[];for(let s=0;s<t.length-1;s++){const o=new h;o.start={x:t[s].x,y:t[s].y},o.end={x:t[s+1].x,y:t[s+1].y},e.push(o)}return console.log(e),e}createPoints(){return[this.start,...this.points,this.end]}rotateSegmentPoints(t,e,s,o){t.forEach((t=>{t.start=n.rotate(t.start,e,s,o),t.end=n.rotate(t.end,e,s,o)}))}rotateSegment(t,e,s,n){t.start=o.rotatePoint(t.start,e,s,n),t.end=o.rotatePoint(t.end,e,s,n)}createRotatedPoints(t,e,s){return n.rotate([this.start,...this.points,this.end],t,e,s)}}class f extends l{constructor(t,e,s,o){super(),this.floor=t,this.wall=e,this.fixedPoint=s,this.movePoint=o,this.controls=[],this.ruler=new w(this.wall.start,this.wall.end)}onDragStart(t,e,s){t.addForegroundControl(this.ruler)}onDrag(t,e){const s=o.radianInPoint(this.fixedPoint,this.movePoint);this.movePoint.x=t,this.movePoint.y=e;const n=o.radianInPoint(this.fixedPoint,this.movePoint),i=r.createVectorOfPoints(this.fixedPoint,this.movePoint);console.log(i),console.log(`x : ${i.x}, y : ${i.y}`),console.log(`radian : ${Math.atan2(i.x,i.y)}`),this.rotate(n-s)}rotate(t){for(const e of this.controls)[e.start,e.end].map((e=>{const s=o.rotate(e.x,e.y,this.fixedPoint.x,this.fixedPoint.y,t);e.x=s[0],e.y=s[1]}))}onDragStop(t,e){const s=this.wall.createOuterPolygon();for(const t of this.controls)s.containsInPoint(t.start)&&s.containsInPoint(t.end)||this.floor.removeControl(t);this.floor.removeForegroundControl(this.ruler)}}class g extends s{constructor(t,e){super(),this.start=t,this.end=e,this.thick=10,this.color="#000000"}isPointInControl(t,e){return this.createOuterPolygon().contains(t,e)}createOuterPolygon(t=0){return i.createOuterPolygon(this.start,this.end,this.thick,t)}drawPoint(t,e,s,o,n){const i=Math.atan2(o-e,s-t),r=t-n*Math.cos(i),h=e-n*Math.sin(i);ctx.beginPath(),ctx.arc(r,h,3,0,2*Math.PI),ctx.fill()}}class v{constructor(t,e){this.A=t,this.B=e}static createEquationFrom4Point(t,e,s,o){return s-t==0?new v("v",t):o-e==0?new v("h",e):new v((o-e)/(s-t),o-s*((o-e)/(s-t)))}closestPoint(t,e){if("v"===this.A)return{x:this.B,y:e};if("h"===this.A)return{x:t,y:this.B};const s=(this.A*e+t-this.A*this.B)/(this.A*this.A+1);return{x:s,y:this.A*s+this.B}}distance(t,e){const s=this.closestPoint(t,e);return Math.sqrt((t-s.x)**2+(e-s.y)**2)}createPerpendicularEquation(t,e){return"string"!=typeof this.A?new v(-1/this.A,e- -1/this.A*t):"h"===this.A?new v("v",t):"v"===this.A?new v("h",e):void 0}createMoveEquation(t,e){return"v"===this.A?new v("v",t):"h"===this.A?new v("h",e):new v(this.A,e-t*this.A)}intersection(t){let e=null;if(this.A===t.A&&(e=!1),"v"===this.A&&"h"===t.A&&(e={x:this.B,y:t.B}),"h"===this.A&&"v"===t.A&&(e={x:t.B,y:this.B}),"h"===this.A&&"v"!==t.A&&"h"!==t.A&&(e={x:(this.B-t.B)/t.A,y:this.B}),"v"===this.A&&"v"!==t.A&&"h"!==t.A&&(e={x:this.B,y:t.A*this.B+t.B}),"h"===t.A&&"v"!==this.A&&"h"!==this.A&&(e={x:(t.B-this.B)/this.A,y:t.B}),"v"===t.A&&"v"!==this.A&&"h"!==this.A&&(e={x:t.B,y:this.A*t.B+this.B}),"h"!==this.A&&"v"!==this.A&&"v"!==t.A&&"h"!==t.A){const s=(t.B-this.B)/(this.A-t.A);e={x:s,y:this.A*s+this.B}}return e}}class p extends l{constructor(t,e,s){super(),this.fixedStart=t.copy(),this.fixedEnd=e.copy(),this.start=t,this.end=e,this.equation=s}onDragStart(t,e,s){this.startVector=r.createVector(e,s,this.start.x,this.start.y),this.endVector=r.createVector(e,s,this.end.x,this.end.y)}onDrag(t,e){this.startVector=r.createVector(t,e,this.fixedStart.x,this.fixedStart.y),this.endVector=r.createVector(t,e,this.fixedEnd.x,this.fixedEnd.y),this.startVector.dotProduct(this.endVector)<0||(this.start.x=this.fixedStart.x,this.start.y=this.fixedStart.y,this.end.x=this.fixedEnd.x,this.end.y=this.fixedEnd.y)}}class C extends s{constructor(t){super(),this.control=t}get type(){return"window-select"}render(t){this.control&&(t.save(),this.renderPoints(t,[this.control.start,this.control.end]),this.renderLines(t,[this.control.start,this.control.end]),t.restore())}renderPoints(t,e){t.fillStyle=x.activeColor;for(const s of e)t.circle(s.x,s.y,10),t.fill()}renderLines(t,e){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)t.lineTo(e[s].x,e[s].y);t.closePath(),t.lineWidth=2,t.strokeStyle=x.selectColor,t.stroke()}}class m extends g{constructor(t,e){super(t,e)}get type(){return"wall"}cutting(t,e,s){const o={x:this.end.x,y:this.end.y};this.end.x=e,this.end.y=s,t.createWall(e,s,o.x,o.y).thick=this.thick}createPointDragHandler(t,e,s){if(this.start.distance(e,s)<10){const e=new f(t,this,this.end,this.start);for(const s of t.findControlsOnWall(this))e.controls.push(s);return e}if(this.end.distance(e,s)<10){const e=new f(t,this,this.start,this.end);for(const s of t.findControlsOnWall(this))e.controls.push(s);return e}return null}createExtendDragHandler(t,e,s){return this.isPointInControl(e,s)?new p(this.start,this.end):null}createMoveDragHandler(t,e,s){if(this.isPointInControl(e,s)){const e=new c(t,this,t.findControlsOnWall(this));return e.addHandler(this.createStartPointHandlers(t,e)),e.addHandler(this.createEndPointHandlers(t,e)),e.addHandler(this.createWallHandlers(t)),e}return null}createStartPointHandlers(t,e){return this.createPointHandlers(t,e,t.getPointConnectedWall(this,this.start,this.end),"start")}createEndPointHandlers(t,e){return this.createPointHandlers(t,e,t.getPointConnectedWall(this,this.end,this.start),"end")}createPointHandlers(t,e,s,o){const n=[];if(s)if(s.point)if(s.angle>175&&s.angle<185)if("start"===o){const e=new m(this.start.copy(),this.start.copy());t.walls.push(e),n.push(new d(e,e.end,o))}else{const e=new m(this.end.copy(),this.end.copy());t.walls.push(e),n.push(new d(e,e.end,o))}else"start"===o?e.startPointEquation=s.wall.createEquation():e.endPointEquation=s.wall.createEquation(),n.push(new d(s.wall,s.point,o));else"start"===o?e.startPointEquation=s.wall.createEquation():e.endPointEquation=s.wall.createEquation(),n.push(new u(s.wall,o));return n}createWallHandlers(t){const e=new y,s=t.getLineConnectedWalls(this);for(const t of s)e.addFollow(t.wall,t.point);return[e]}createSelectionControl(){return new C(this)}createEquation(){return v.createEquationFrom4Point(this.start.x,this.start.y,this.end.x,this.end.y)}createPerpendicularEquation(t,e){if(1===arguments.length){const e=t;if(e instanceof n)return this.createEquation().createPerpendicularEquation(e.x,e.y)}else if(arguments.length>=2)return this.createEquation().createPerpendicularEquation(t,e);return null}distance(t,e){return this.createEquation().distance(t,e)}createClosestPoint(t,e){return this.createEquation().closestPoint(t,e)}createDistancePoint(t,e,s){const o=this.createEquation().closestPoint(t,e),n=Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x);return{x:o.x+s*Math.cos(n),y:o.y+s*Math.sin(n)}}isPointOnBoundary(t){const{start:e,end:s}=this,o=Math.min(e.x,s.x),n=Math.max(e.x,s.x),i=Math.min(e.y,s.y),r=Math.max(e.y,s.y);return t.x>=o&&t.x<=n&&t.y>=i&&t.y<=r}renderControl(t){t.save(),t.beginPath(),t.lineWidth=this.thick,t.strokeStyle=this.color,t.moveTo(this.start.x,this.start.y),t.lineTo(this.end.x,this.end.y),t.closePath(),t.stroke(),t.restore()}}class P{constructor(){this.rooms=[],this.walls=[],this.windows=[],this.doors=[],this.backgrounds=[],this.foregrounds=[]}clear(){this.rooms=[],this.walls=[],this.windows=[],this.doors=[],this.backgrounds=[],this.foregrounds=[]}render(t){this.renderBackground(t),this.renderFloor(t),this.renderForeground(t)}renderBackground(t){for(const e of this.backgrounds)e.render(t)}renderFloor(t){for(const e of this.rooms)e.render(t);for(const e of this.walls)e.render(t);for(const e of this.doors)e.render(t);for(const e of this.windows)e.render(t)}renderForeground(t){for(const e of this.foregrounds)e.render(t)}createWall(t,e,s,o){let i=this.findWall(t,e,s,o);return i||(i=new m(new n(t,e),new n(s,o)),this.walls.push(i)),i}findWall(t,e,s,o){for(const n of this.walls){const{start:i,end:r}=n;if(i.x===t&&i.y===e&&r.x===s&&r.y===o)return n;if(r.x===t&&r.y===e&&i.x===s&&i.y===o)return n}for(const n of this.walls){const i=n.createOuterPolygon(10);if(i.contains(t,e)&&i.contains(s,o))return n}return null}findControlsOnWall(t){const e=t.createOuterPolygon(),s=[];for(const t of this.doors)e.contains(t.start.x,t.start.y)&&e.contains(t.end.x,t.end.y)&&s.push(t);for(const t of this.windows)e.contains(t.start.x,t.start.y)&&e.contains(t.end.x,t.end.y)&&s.push(t);return s}removeControl(t){let e=this.walls.indexOf(t);if(-1!==e){this.walls.splice(e,1);for(const e of this.findControlsOnWall(t))this.removeControl(e)}e=this.windows.indexOf(t),-1!==e&&this.windows.splice(e,1),e=this.doors.indexOf(t),-1!==e&&this.doors.splice(e,1)}getControlsOnCoordinates(t,e,s=null){const o=[];for(const n of this.getAllControls())n.isPointInControl(t,e)&&(s&&s(n),o.push(n));return o}getWallsOnCoordinates(t,e,s=null){const o=[];for(const n of this.walls)n.isPointInControl(t,e)&&(s?s(n)&&o.push(n):o.push(n));return o}getClosestWallOnCoordinates(t,e){let s=null,o=1/0;for(const n of this.walls){const i=n.distance(t,e);if(i<5)return n;i<o&&(s=n,o=i)}return s}getDoorsOnCoordinates(t,e,s=null){const o=[];for(const n of this.doors)n.isPointInControl(t,e)&&(s&&s(n),o.push(n));return o}getWindowsOnCoordinates(t,e,s=null){const o=[];for(const n of this.windows)n.isPointInControl(t,e)&&(s&&s(n),o.push(n));return o}cuttingRect(t,e,s,o){const n=a.create(t,e,s,o);for(const t of n.segments())this.cuttingLine(t.x1,t.y1,t.x2,t.y2);n.x-=1,n.y-=1,n.width+=2,n.height+=2;const i=[];for(const t of this.walls)n.isPointInRect(t.start)&&n.isPointInRect(t.end)&&i.push(t);for(const t of this.windows)n.isPointInRect(t.start)&&n.isPointInRect(t.end)&&i.push(t);for(const t of this.doors)n.isPointInRect(t.start)&&n.isPointInRect(t.end)&&i.push(t);for(const t of i)this.removeControl(t)}getPointConnectedWalls(t,e,s){const n=[];for(const i of this.walls)if(i!==t){const{start:t,end:r}=i;t.x===e.x&&t.y===e.y?n.push({wall:i,point:t,angle:o.calculate3PointAngle(e,r,s)}):r.x===e.x&&r.y===e.y&&n.push({wall:i,point:r,angle:o.calculate3PointAngle(e,t,s)})}if(0===n.length){const s=this.getWallsOnCoordinates(e.x,e.y,(e=>e!==t));s.length>0&&n.push({wall:s[0]})}return n}getPointConnectedWall(t,e,s){const o=this.getPointConnectedWalls(t,e,s);return o.length>0?o[0]:null}getLineConnectedWalls(t){const e=e=>t.start.x===e.x&&t.start.y===e.y||t.end.x===e.x&&t.end.y===e.y,s=t.createOuterPolygon(5),o=[];for(const n of this.walls)if(n!==t){if(e(n.start)||e(n.end))continue;const{start:t,end:i}=n;s.contains(t.x,t.y)?o.push({wall:n,point:t}):s.contains(i.x,i.y)&&o.push({wall:n,point:i})}return o}cuttingLine(t,e,s,n){const i=[];for(const r of this.walls){const h=o.interceptPoint(t,e,s,n,r.start.x,r.start.y,r.end.x,r.end.y);h&&i.push({point:h,wall:r})}for(const t of i)t.wall.cutting(this,t.point.x,t.point.y)}addForegroundControl(t){t&&this.foregrounds.push(t)}removeForegroundControl(t){t&&(this.foregrounds=this.foregrounds.filter((e=>e!==t)))}removeAllForegroundControls(){this.foregrounds=[]}getAllControls(){return[...this.doors,...this.windows,...this.walls,...this.rooms]}}class D{render(t,e,s,o){}}class F extends D{constructor(t){super(),this.display=!t||!t.display||t.display,this.size=t&&t.size?t.size:100,this.color=t&&t.color?t.color:"#c2c1c1",this.thick=t&&t.thick?t.thick:1}render(t,e,s,o){if(this.display){e.save(),e.setTransform(1,0,0,1,0,0),e.beginPath(),e.strokeStyle=this.color,e.lineWidth=this.thick;for(let s=this.size;s<t.width;s+=this.size)e.moveTo(s,0),e.lineTo(s,t.height);for(let s=this.size;s<t.height;s+=this.size)e.moveTo(0,s),e.lineTo(t.width,s);e.stroke(),e.restore()}}}class A extends D{render(t,e,s,o){o.render(e)}}class E extends D{render(t,e,s,o){let n=1/0,i=1/0,r=-1/0,h=-1/0;for(const t of o.walls){const{start:e,end:s}=t;n=Math.min(n,e.x,s.x),r=Math.max(r,e.x,s.x),i=Math.min(i,e.y,s.y),h=Math.max(h,e.y,s.y)}const a=50;this.renderLine(e,n,i-a,r,i-a),this.renderArrow(e,n,i-a,5,4),this.renderArrow(e,r,i-a,5,2),this.renderLine(e,r+a,i,r+a,h),this.renderArrow(e,r+a,i,5,1),this.renderArrow(e,r+a,h,5,3)}renderLine(t,e,s,o,n){t.beginPath(),t.strokeStyle="#666666",t.fillStyle="#666666",t.lineWidth=1,t.moveTo(e,s),t.lineTo(o,n),t.stroke()}renderArrow(t,e,s,o,n){switch(n){case 1:t.beginPath(),t.moveTo(e,s),t.lineTo(e-o,s+o),t.moveTo(e,s),t.lineTo(e+o,s+o),t.closePath(),t.stroke();break;case 2:t.beginPath(),t.moveTo(e,s),t.lineTo(e-o,s-o),t.moveTo(e,s),t.lineTo(e-o,s+o),t.closePath(),t.stroke();break;case 3:t.beginPath(),t.moveTo(e,s),t.lineTo(e-o,s-o),t.moveTo(e,s),t.lineTo(e+o,s-o),t.closePath(),t.stroke();break;case 4:t.beginPath(),t.moveTo(e,s),t.lineTo(e+o,s-o),t.moveTo(e,s),t.lineTo(e+o,s+o),t.closePath(),t.stroke()}}}class M{constructor(){this.clientX=0,this.clientY=0,this.snapX=0,this.snapY=0,this.x=0,this.y=0}}class H{constructor(t){this.handlers=[],this.snapToGrid=!0,this.context=t}addHandler(t){t&&this.handlers.push(t)}removeHandler(t){t&&(this.handlers=this.handlers.filter((e=>e!==t)))}onClick(t){for(const e of this.handlers)e.onClick(t)}onKeyDown(t,e){console.log(`key down ${t}, ${e}`);for(const s of this.handlers)s.onKeyDown(t,e)}onMouseDown(t,e){const s=new M;s.clientX=t,s.clientY=e;const o=this.transformPoint(t,e),n=this.snapPoint(o);s.snapX=n.x,s.snapY=n.y,s.x=o.x,s.y=o.y;for(const t of this.handlers)t.useSnap(),t.onMouseDown(s)}onMouseMove(t,e){const s=new M;s.clientX=t,s.clientY=e;const o=this.transformPoint(t,e),n=this.snapPoint(o);s.snapX=n.x,s.snapY=n.y,s.x=o.x,s.y=o.y;for(const t of this.handlers)t.useSnap(),t.onMouseMove(s)}onMouseUp(t,e){const s=new M;s.clientX=t,s.clientY=e;const o=this.transformPoint(t,e),n=this.snapPoint(o);s.snapX=n.x,s.snapY=n.y,s.x=o.x,s.y=o.y;for(const t of this.handlers)t.useSnap(),t.onMouseUp(s)}snap(t){return this.snapToGrid?10*Math.round(t/10):t}snapPoint(t){return{x:this.snap(t.x),y:this.snap(t.y)}}transformPoint(t,e){const s=this.context.getTransform(),o=s.e,n=s.f;return{x:t-o/s.a,y:e-n/s.d}}}class B{onCommandActive(t){}onCommandDeActive(t){}}class S{constructor(){}useSnap(){return!0}onClick(t){}onKeyDown(t,e){}onMouseDown(t){}onMouseMove(t){}onMouseUp(t){}}class T extends B{constructor(t){super(),this.handler=new O(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class O extends S{constructor(t){super(),this.editor=t,this.hanlders=[],this.canvasmovehandler=new k(t)}useSnap(){return!1}onKeyDown(t,e){if("Backspace"===t){for(const t of this.editor.floor.walls)t.selected&&this.editor.floor.removeControl(t);this.editor.render()}else alert(`key : ${t}, code : ${e}`)}onMouseDown(t){const e=this.editor.floor;for(const s of e.getAllControls()){const o=s.createPointDragHandler(e,t.x,t.y);o&&(this.editor.addSelectControls([s.createSelectionControl()]),this.hanlders.push(o))}if(0===this.hanlders.length){this.editor.selectControl(null,t.x,t.y);for(const s of e.getAllControls()){const o=s.createMoveDragHandler(e,t.x,t.y);if(o){this.editor.setSelectControls([s.createSelectionControl()]),this.hanlders.push(o);break}}}0===this.hanlders.length&&(this.editor.setSelectControls([]),this.editor.selectControl(null,t.x,t.y));for(const s of this.hanlders)s.onDragStart(e,t.x,t.y);0===this.hanlders.length&&this.canvasmovehandler.onDragStart(e,t.clientX,t.clientY),this.editor.render()}onMouseMove(t){for(const e of this.hanlders)e.onDrag(t.x,t.y);0===this.hanlders.length&&this.canvasmovehandler.onDrag(t.clientX,t.clientY),this.editor.render()}onMouseUp(t){for(const e of this.hanlders)e.onDragStop(t.x,t.y);0===this.hanlders.length&&this.canvasmovehandler.onDragStop(t.clientX,t.clientY),this.editor.render(),this.hanlders=[]}}class k extends l{constructor(t){super(),this.editor=t,this.startX=0,this.startY=0,this.started=!1}onDragStart(t,e,s){this.startX=e,this.startY=s,this.started=!0}onDrag(t,e){if(this.started){if(this.editor){const s=t-this.startX,o=e-this.startY;this.editor.translate(s,o)}this.startX=t,this.startY=e}}onDragStop(t,e){this.started=!1}}class R extends B{constructor(t,e){super(),this.handler=new b(t,e)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class b extends S{constructor(t,e){super(),this.editor=t,this.control=new W,this.started=!1,this.clear=e}onMouseDown(t){this.started=!0,this.control.initialize(t.x,t.y),this.editor.floor.addForegroundControl(this.control)}onMouseMove(t){this.started&&(this.control.move(t.x,t.y),this.editor.render())}onMouseUp(t){const e=this.editor.floor;if(e.removeForegroundControl(this.control),this.started){if(this.clear){const t=this.control.rect;e.cuttingRect(t.x,t.y,t.width,t.height)}for(const t of this.control.rect.segments())this.createWall(t);this.editor.render()}this.started=!1,this.editor.tools.select()}createWall(t){this.editor.floor.createWall(t.x1,t.y1,t.x2,t.y2)}}class W extends s{constructor(){super(),this.rect=new a,this.widthRuler=new w(this.start,this.end),this.heightRuler=new w(this.start,this.end)}initialize(t,e){this.rect.x=t,this.rect.y=e,this.rect.width=0,this.rect.height=0}move(t,e){this.rect.width=t-this.rect.x,this.rect.height=e-this.rect.y}render(t){t.save(),t.beginPath(),t.lineWidth=10,t.strokeStyle=x.activeColor,t.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),t.stroke(),t.closePath(),this.renderWidthRuler(t),this.renderHeightRuler(t),t.restore()}renderWidthRuler(t){this.widthRuler.start=this.rect.getTopLeftPoint(),this.widthRuler.end=this.rect.getTopRightPoint(),this.widthRuler.render(t)}renderHeightRuler(t){this.heightRuler.start=this.rect.getTopRightPoint(),this.heightRuler.end=this.rect.getBottomRightPoint(),this.heightRuler.render(t)}}class I extends g{constructor(t,e){super(t,e)}get type(){return"window"}render(t){const e=o.radianInPoint(this.start,this.end),s=o.distanceInPoint(this.start,this.end),n=this.createWindowPath(s,10);t.save(),t.translate(this.start.x,this.start.y),t.rotate(e),t.lineWidth=1,t.strokeStyle="#000000",t.fillStyle="#ffffff",t.fill(n),t.stroke(n),t.restore()}createWindowPath(t,e){const s=e/3,o=new Path2D;o.rect(0,-5,t,e);for(let e=0;e<3;e++)o.rect(5,s*e-5,t-10,s);return o}createPointDragHandler(t,e,s){const o=t.getWallsOnCoordinates(this.start.x,this.start.y);return this.start.distance(e,s)<10?new q(t,o[0],this,this.start):this.end.distance(e,s)<10?new q(t,o[0],this,this.end):null}createMoveDragHandler(t,e,s){if(this.isPointInControl(e,s)){const e=t.getWallsOnCoordinates(this.start.x,this.start.y);if(e.length>0)return new L(t,e[0],this)}return null}createSelectionControl(){return new C(this)}}class q extends l{constructor(t,e,s,o){super(),this.floor=t,this.wall=e,this.window=s,this.point=o,this.control=null}onDragStart(t,e,s){this.control=new w(this.wall.start,this.wall.end),this.control.addPoint(this.window.start),this.control.addPoint(this.window.end),this.floor.addForegroundControl(this.control)}onDrag(t,e){const s=this.wall.createClosestPoint(t,e);this.wall.isPointOnBoundary(s)&&(this.point.x=s.x,this.point.y=s.y)}onDragStop(t,e){this.floor.removeForegroundControl(this.control)}}class L extends l{constructor(t,e,s){super(),this.floor=t,this.wall=e,this.window=s,this.startVector=0,this.endVector=0,this.control=null}onDragStart(t,e,s){const o=this.wall.createClosestPoint(e,s);this.startVector=r.createVectorOfPoints(o,this.window.start),this.endVector=r.createVectorOfPoints(o,this.window.end),this.control=new w(this.wall.start,this.wall.end),this.control.addPoint(this.window.start),this.control.addPoint(this.window.end),this.floor.addForegroundControl(this.control)}onDrag(t,e){const s=this.floor.getClosestWallOnCoordinates(t,e);if(s){const o=s.createDistancePoint(t,e,this.startVector.getLength()),n=s.createDistancePoint(t,e,-this.endVector.getLength());s.isPointOnBoundary(o)&&s.isPointOnBoundary(n)&&(this.updateControl(s.start,s.end),this.updateWindow(n,o))}}onDragStop(t,e){this.floor.removeForegroundControl(this.control)}updateControl(t,e){this.control.start=t,this.control.end=e}updateWindow(t,e){this.window.start.x=t.x,this.window.start.y=t.y,this.window.end.x=e.x,this.window.end.y=e.y}}class V extends B{constructor(t){super(),this.handler=new G(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class G extends S{constructor(t){super(),this.control=null,this.editor=t,this.wall=null,this.window=null}onMouseDown(t){let e=this.editor.floor.getControlsOnCoordinates(t.x,t.y,(t=>"wall"===t.type));if(e.length<=0)return;this.wall=e[0];const s=this.wall.createClosestPoint(t.x,t.y);this.window=new I(new n(s.x,s.y),new n(s.x,s.y)),this.control=new w(this.wall.start,this.wall.end),this.control.addPoint(this.window.start),this.control.addPoint(this.window.end),this.editor.floor.addForegroundControl(this.control)}onMouseMove(t){if(this.window){const e=this.wall.createClosestPoint(t.x,t.y);this.window.end.x=e.x,this.window.end.y=e.y,this.editor.render(),this.editor.render(),this.window.render(this.editor.context)}}onMouseUp(t){this.window&&(this.editor.floor.removeForegroundControl(this.control),this.editor.floor.windows.push(this.window),this.wall=null,this.window=null,this.editor.render(),this.editor.tools.select())}}class X extends g{constructor(t,e){super(t,e)}get type(){return"door"}render(t){const e=o.radianInPoint(this.start,this.end),s=o.distanceInPoint(this.start,this.end),n=this.createDoorPath(s,10);t.save(),t.translate(this.start.x,this.start.y),t.rotate(e),t.lineWidth=1,t.strokeStyle="#000000",t.fillStyle="#ffffff",t.fill(n),t.stroke(n),t.restore()}createDoorPath(t,e){const s=new Path2D;return s.rect(0,-5,t,e),s.arc(0,-5,t,0,Math.PI/2),s.moveTo(0,-5),s.lineTo(0,-5+t),s}createPointDragHandler(t,e,s){const o=t.getWallsOnCoordinates(this.start.x,this.start.y);return this.start.distance(e,s)<10?new Y(t,o[0],this,this.start):this.end.distance(e,s)<10?new Y(t,o[0],this,this.end):null}createMoveDragHandler(t,e,s){if(this.isPointInControl(e,s)){const e=t.getWallsOnCoordinates(this.start.x,this.start.y);if(e.length>0)return new z(t,e[0],this)}return null}createSelectionControl(){return new C(this)}}class Y extends l{constructor(t,e,s,o){super(),this.floor=t,this.wall=e,this.door=s,this.point=o,this.control=null}onDragStart(t,e,s){this.control=new w(this.wall.start,this.wall.end),this.control.addPoint(this.door.start),this.control.addPoint(this.door.end),this.floor.addForegroundControl(this.control)}onDrag(t,e){const s=this.wall.createClosestPoint(t,e);this.wall.isPointOnBoundary(s)&&(this.point.x=s.x,this.point.y=s.y)}onDragStop(t,e){this.floor.removeForegroundControl(this.control)}}class z extends l{constructor(t,e,s){super(),this.floor=t,this.wall=e,this.door=s,this.startVector=0,this.endVector=0,this.control=null}onDragStart(t,e,s){const o=this.wall.createClosestPoint(e,s);this.startVector=r.createVectorOfPoints(o,this.door.start),this.endVector=r.createVectorOfPoints(o,this.door.end),this.control=new w(this.wall.start,this.wall.end),this.control.addPoint(this.door.start),this.control.addPoint(this.door.end),this.floor.addForegroundControl(this.control)}onDrag(t,e){const s=this.floor.getClosestWallOnCoordinates(t,e);if(s){const o=s.createDistancePoint(t,e,this.startVector.getLength()),n=s.createDistancePoint(t,e,-this.endVector.getLength());s.isPointOnBoundary(o)&&s.isPointOnBoundary(n)&&(this.updateControl(s.start,s.end),this.updateDoor(n,o))}}onDragStop(t,e){this.floor.removeForegroundControl(this.control)}updateControl(t,e){this.control.start=t,this.control.end=e}updateDoor(t,e){this.door.start.x=t.x,this.door.start.y=t.y,this.door.end.x=e.x,this.door.end.y=e.y}}class $ extends B{constructor(t){super(),this.handler=new j(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class j extends S{constructor(t){super(),this.editor=t,this.control=null,this.wall=null,this.door=null}onMouseDown(t){let e=this.editor.floor.getControlsOnCoordinates(t.x,t.y,(t=>"wall"===t.type));if(e.length<=0)return;this.wall=e[0];const s=this.wall.createClosestPoint(t.x,t.y);this.door=new X(new n(s.x,s.y),new n(s.x,s.y)),this.control=new w(this.wall.start,this.wall.end),this.control.addPoint(this.door.start),this.control.addPoint(this.door.end),this.editor.floor.addForegroundControl(this.control)}onMouseMove(t){if(this.door){const e=this.wall.createClosestPoint(t.x,t.y);this.door.end.x=e.x,this.door.end.y=e.y,this.editor.render(),this.door.render(this.editor.context)}}onMouseUp(t){this.door&&(this.editor.floor.removeForegroundControl(this.control),this.editor.floor.doors.push(this.door),this.wall=null,this.door=null,this.render=null,this.editor.render(),this.editor.tools.select())}}class U extends B{constructor(t){super(),this.handler=new K(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class K extends S{constructor(t){super(),this.editor=t,this.control=new _(this),this.started=!0,this.start=new n(0,0),this.end=new n(0,0),this.cuttings=[]}onMouseDown(t){this.started=!0,this.start.x=t.x,this.start.y=t.y,this.end.x=t.x,this.end.y=t.y,this.editor.setSelectControls([this.control])}onMouseMove(t){this.end.x=t.x,this.end.y=t.y,this.started&&(this.createCutting(),this.editor.render())}onMouseUp(t){if(this.started){for(const t of this.cuttings)t.wall.cutting(this.editor.floor,t.point.x,t.point.y);this.started=!1,this.editor.render(),this.editor.tools.select(),this.cuttings=[]}this.editor.setSelectControls([])}createCutting(){this.cuttings=[];for(const t of this.editor.floor.walls){const e=o.interceptPoint(this.start.x,this.start.y,this.end.x,this.end.y,t.start.x,t.start.y,t.end.x,t.end.y);e&&this.cuttings.push({point:e,wall:t})}}}class _{constructor(t){this.handler=t}render(t){t.save(),this.renderLine(t),this.renderCuttings(t),t.restore()}renderLine(t){t.lineWidth=1,t.strokeStyle=x.Colors.Red50,t.beginPath(),t.setLineDash([5,10]),t.moveTo(this.handler.start.x,this.handler.start.y),t.lineTo(this.handler.end.x,this.handler.end.y),t.closePath(),t.stroke(),t.setLineDash([])}renderCuttings(t){for(const e of this.handler.cuttings)t.fillStyle=x.Colors.Red50,t.beginPath(),t.arc(e.point.x,e.point.y,10,0,2*Math.PI),t.closePath(),t.fill()}}class J extends B{constructor(t){super(),this.handler=new N(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class N extends S{constructor(t){super(),this.editor=t,this.control=new Q,this.started=!1}onMouseDown(t){this.started=!0,this.control.start.x=t.x,this.control.start.y=t.y,this.editor.floor.addForegroundControl(this.control)}onMouseMove(t){this.started&&(this.control.end.x=t.x,this.control.end.y=t.y,this.editor.render())}onMouseUp(t){this.started&&(this.editor.floor.createWall(this.control.start.x,this.control.start.y,t.x,t.y),this.editor.floor.removeForegroundControl(this.control),this.editor.render(),this.editor.tools.select()),this.started=!1}}class Q extends s{constructor(){super(),this.start=new n(0,0),this.end=new n(0,0),this.ruler=new w(this.start,this.end)}render(t){t.lineWidth=10,t.strokeStyle="#0097c5",t.line(this.start.x,this.start.y,this.end.x,this.end.y),this.ruler.render(t)}}class Z{static createLine(t){return(e,s,o,n)=>{t.beginPath(),t.moveTo(e,s),t.lineTo(o,n),t.closePath(),t.stroke()}}static createText(t){return(e,s,o)=>{const n=t.measureText(o).width;t.fillText(o,e-n/2,s)}}static createCircle(t){return(e,s,o)=>{t.beginPath(),t.arc(e,s,o,0,2*Math.PI),t.closePath()}}static createArrow(t){return(e,s,o,n)=>{switch(n){case"up":t.beginPath(),t.moveTo(e,s),t.lineTo(e-o,s+o),t.lineTo(e+o,s+o),t.closePath(),t.fill();break;case"right":t.beginPath(),t.moveTo(e,s),t.lineTo(e-o,s-o),t.lineTo(e-o,s+o),t.closePath(),t.fill();break;case"down":t.beginPath(),t.moveTo(e,s),t.lineTo(e-o,s-o),t.lineTo(e+o,s-o),t.closePath(),t.fill();break;case"left":t.beginPath(),t.moveTo(e,s),t.lineTo(e+o,s-o),t.lineTo(e+o,s+o),t.closePath(),t.fill()}}}}class tt extends s{constructor(){super(),this.start=null,this.end=null,this.thick=10}render(t){this.start&&this.end&&(t.lineWidth=this.thick,t.strokeStyle="rgba(255, 59, 48, 0.7)",t.line(this.start.x,this.start.y,this.end.x,this.end.y),t.circle(this.start.x,this.start.y,10),t.circle(this.end.x,this.end.y,10))}}class et extends B{constructor(t){super(),this.handler=new st(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class st extends S{constructor(t){super(),this.editor=t,this.control=null}useSnap(){return!1}onMouseDown(t){const e=this.findEraseControl(t.x,t.y);e&&(this.editor.floor.removeControl(e),this.hideControl())}onMouseMove(t){const e=this.findEraseControl(t.x,t.y);e?this.showControl(e.start,e.end):this.hideControl()}showControl(t,e){this.control||(this.control=new tt,this.editor.floor.addForegroundControl(this.control)),this.control.start===t&&this.control===e||(this.control.start=t,this.control.end=e,this.editor.render())}hideControl(){this.control&&(this.editor.floor.removeForegroundControl(this.control),this.control=null,this.editor.render())}findEraseControl(t,e){const s=this.editor.floor.getControlsOnCoordinates(t,e);if(0===s.length)return null;if(1===s.length)return s[0];for(const t of s)if("wall"!==t.type)return t;return null}}class ot extends B{constructor(t,e){super(),this.editor=t,this.scale=e}onCommandActive(t){this.editor.scale+=this.scale,this.editor.context.setTransform(this.editor.scale,0,0,this.editor.scale,0,0),this.editor.render(),this.editor.tools.select()}onCommandDeActive(t){}}class nt extends B{constructor(t){super(),this.editor=t}onCommandActive(t){this.editor.floor.clear(),this.editor.render(),this.editor.tools.select()}onCommandDeActive(t){}}class it extends s{constructor(t){super(),this.room=t}get type(){return"room-select"}render(t){this.room.points.length>0&&(t.save(),this.renderPoints(t,this.room.points),this.renderLines(t,this.room.points),t.restore())}renderPoints(t,e){t.fillStyle=x.selectColor;for(const s of e)t.circle(s.x,s.y,10),t.fill()}renderLines(t,e){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)t.lineTo(e[s].x,e[s].y);t.closePath(),t.lineWidth=2,t.strokeStyle=x.selectColor,t.stroke()}}class rt extends s{constructor(){super(),this.points=[],this.fillColor="rgba(131,208,221,0.5)"}get type(){return"room"}render(t){if(this.points.length>0){t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(let e=1;e<this.points.length;e++)t.lineTo(this.points[e].x,this.points[e].y);t.closePath(),t.fillStyle=this.fillColor,t.fill()}}createMoveDragHandler(t,e,s){return this.isPointInControl(e,s)?new l:null}createSelectionControl(){return new it(this)}isPointInControl(t,e){return i.isPointInPolygon(this.points,t,e)}}class ht{static importData(t,e){new at(4).importData(t,e)}static exportData(t){}}class at{constructor(t){this.scale=t}importData(t,e){for(const s of e)"STR"===s.type?this.importSTR(t,s.categories):"SPA"===s.type&&this.importSPA(t,s.categories)}importSTR(t,e){for(const s of e)0!==s.category&&1!==s.category&&2!==s.category&&3!==s.category&&4!==s.category&&5!==s.category&&6!==s.category&&7!==s.category||this.importObjectFromSTR(t,s.category,s.objects)}importObjectFromSTR(t,e,s){for(const o of s){if("line"===o.type){const s=new n(o.data[0][0]*this.scale,o.data[0][1]*this.scale),i=new n(o.data[1][0]*this.scale,o.data[1][1]*this.scale);if(0===e||1===e){const o=new m(s,i);1===e&&(o.thick=5),t.floor.walls.push(o)}else if(2===e||3===e||4===e){const e=new X(s,i);t.floor.doors.push(e)}else if(5===e||6===e||7===e){const e=new I(s,i);t.floor.windows.push(e)}else{const e=new m(s,i);t.floor.walls.push(e)}}if("polygon"===o.type){const e=new rt;for(const t of o.data)e.points.push(new n(t[0]*this.scale,t[1]*this.scale));t.floor.rooms.push(e)}}}importSPA(t,e){for(const s of e)11!==s.category&&this.importObjectFromSPA(t,s.category,s.objects)}importObjectFromSPA(t,e,s){for(const e of s)if("Polygon"===e.type){const s=new rt;for(const t of e.data)s.points.push(new n(t[0]*this.scale,t[1]*this.scale));t.floor.rooms.push(s)}}}class lt{constructor(){this.canvas=null,this.context=null,this.tools=new ct(this),this.floor=new P,this.renders=[],this.scale=1,this.activeCommand=null,this.onSelectListener=null,this.eventController=new H,this.config=null,this.selects=[]}edit(t,e){if(this.config=e,window&&document){const s=document.querySelector(t);s?(s.tabIndex=1,s.style.outline="none",this.renders.push(new F(e.grid)),this.renders.push(new A),this.renders.push(new E),this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.tabindex=2,this.canvas.style.outline="none",this.context=this.canvas.getContext("2d"),this.initializeCanvas(s,window),this.render(),s.appendChild(this.canvas),this.canvas.focus()):console.log(`${t} 요소를 찾을 수 없습니다.`)}}import(t){ht.importData(this,t),this.render()}export(){}initializeCanvas(t,e){if(e&&this.canvas&&this.context){this.context.line=Z.createLine(this.context),this.context.arrow=Z.createArrow(this.context),this.context.text=Z.createText(this.context),this.context.circle=Z.createCircle(this.context);const s=e.devicePixelRatio||1,o=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,n=s/o;if(this.scale=n,s!==o){const t=this.canvas.width,e=this.canvas.height;this.canvas.width=t*n,this.canvas.height=e*n,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.context.scale(n,n)}this.context.lineJoin="round",this.context.lineCap="square",this.context.imageSmoothingEnabled=!0,this.canvas.addEventListener("mousedown",(t=>{if(this.eventController){let[e,s]=this.getXYFromEvent(t);this.eventController.onMouseDown(e,s)}})),this.canvas.addEventListener("mousemove",(t=>{if(this.eventController){let[e,s]=this.getXYFromEvent(t);this.eventController.onMouseMove(e,s)}})),this.canvas.addEventListener("mouseup",(t=>{if(this.eventController){let[e,s]=this.getXYFromEvent(t);this.eventController.onMouseUp(e,s)}})),this.canvas.addEventListener("click",(t=>{this.eventController&&this.eventController.onClick(t.button)})),t.addEventListener("keydown",(t=>{this.eventController&&this.eventController.onKeyDown(t.key,t.code)})),this.eventController.context=this.context}else console.log(`fail to initialize canvas : {window : ${e}, canvas : ${this.canvas}, context : ${this.context}`)}translate(t,e){this.context.translate(t,e)}getXYFromEvent(t){const e=this.canvas.getBoundingClientRect(),s=this.canvas.width/e.width,o=this.canvas.height/e.height;return[(t.clientX-e.left)*s/this.scale,(t.clientY-e.top)*o/this.scale]}addEventHandler(t){this.eventController.addHandler(t)}removeEventHandler(t){this.eventController.removeHandler(t)}onSelect(t){this.onSelectListener=t}selectControl(t,e,s){this.onSelectListener&&this.onSelectListener(t,e,s)}addSelectControl(t){t&&this.selects.push(t)}setSelectControls(t){t&&(console.log(t),this.selects=t)}addSelectControls(t){console.log(t),t&&this.selects.push(...t)}removeAllSelectControl(){this.selects=[]}render(){this.renderBackground();for(const t of this.renders)t.render(this.canvas,this.context,this,this.floor);for(const t of this.selects)t.render(this.context)}renderBackground(){let t="#ffffff";this.config&&(t=this.config.background?this.config.background:"#ffffff"),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore()}}class ct{constructor(t){this.editor=t}select(){this.deActiveCommand(),this.editor.activeCommand=new T(this.editor),this.activeCommand()}createWall(){this.deActiveCommand(),this.editor.activeCommand=new J(this.editor),this.activeCommand()}createRectWall(t){this.deActiveCommand(),this.editor.activeCommand=new R(this.editor,t),this.activeCommand()}createDoor(){this.deActiveCommand(),this.editor.activeCommand=new $(this.editor),this.activeCommand()}createWindow(){this.deActiveCommand(),this.editor.activeCommand=new V(this.editor),this.activeCommand()}splitWall(){this.deActiveCommand(),this.editor.activeCommand=new U(this.editor),this.activeCommand()}eraseObject(){this.deActiveCommand(),this.editor.activeCommand=new et(this.editor),this.activeCommand()}zoomIn(){this.deActiveCommand(),this.editor.activeCommand=new ot(this.editor,.1),this.activeCommand()}zoomOut(){this.deActiveCommand(),this.editor.activeCommand=new ot(this.editor,-.1),this.activeCommand()}clear(){this.deActiveCommand(),this.editor.activeCommand=new nt(this.editor),this.activeCommand()}deActiveCommand(){this.editor.activeCommand&&this.editor.activeCommand.onCommandDeActive(this.editor),this.editor.activeCommand=null}activeCommand(){this.editor.activeCommand&&this.editor.activeCommand.onCommandActive(this.editor)}}PlaceIn=e})();